**"프로세스 스케줄링"** 과 이와 관련된 **"시스템 해킹의 기초 원리"** 연결.

가상 메모리가 **공간(Memory)** 을 보호했다면, 스케줄링은 **시간(CPU Time)** 을 공평하게 분배하는 역할을 함. 해킹은 이 두 영역의 틈을 파고 듦.

# OS의 시간 관리: 프로세스 스케줄링
일반 OS(Linux 등)에서 수십 개의 프로그램이 동시에 실행되는 것처럼 보이는 이유는 OS 스케줄러가 CPU 시간을 매우 짧게 쪼깨서 분배하기 때문.

#### 프로세스 상태와 문맥 교환 (Context Switching)
RTOS의 **Task** 가 일반 OS에서는 **프로세스(Process)** 또는 **스레드(Thread)** 가 됨.
이들은 다음 세 가지 상태를 반복함.
1. 실행(Running): 현재 CPU를 점유하고 코드를 실행 중인 상태.
2. 준비(Ready): CPU를 사용할 준비는 되었으나, 다른 프로세스가 CPU를 사용 중이라 대기 중인 상태.
3. 대기/블록(Waiting/Blocked): I/O(네트워크, 디스크) 작업을 기다리느라 잠시 멈춘 상태.

- 문맥 교환 (Context Switching): 스케줄러가 A 프로세스를 멈추고 B 프로세스를 실행할 때, A 프로세스의 **모든 레지스터 값(PC, SP 등)** 과 **MMU 페이지 테이블 주소** 를 메모리에 저장하고 B 프로세스의 상태를 로드하는 과정. (RTOS와 본질적으로 같지만, 저장할 데이터가 훨씬 많음.)

#### 스케줄링 정책: 공평함의 기준
OS는 어떤 프로세스에게 CPU를 줄지 결정해야 함.
- Round Robin (라운드 로빈): 모든 프로세스에게 공평하게 아주 짧은 시간(Time Slice)을 주고 순환함. (가장 기본적이고 공평함)
- 우선순위 기반(Priority-based): 중요하거나 급한 프로세스(예: 실시간 오디오)에게 더 많은 CPU 시간을 할당함.
- Shortest Job First: 가장 짧게 끝날 것 같은 프로세스를 먼저 실행함. (처리량 극대화)

# 해킹의 기초: 버퍼 오버플로우 공격 원리
**스택 프레임** 과 **함수 호출 오버헤드** 지식이 해킹에 직접 적용. 해킹은 곧 **CPU의 제어 흐름을 빼앗는 것**

#### 취약점: 버퍼 오버플로우
C 언어에서 `gets()` 함수나 `strcpy()` 함수처럼 **입력받을 크기를 검사하지 않는** 함수를 사용할 때 발생함.
1. 공격: 스택에 할당된 작은 지역 번수 배열(**버퍼**)에 **허용된 크기보다 훨씬 많은 데이터** 를 의도적으로 밀어 넣음.
2. 스택 침범: 밀려 들어온 데이터가 스택의 높은 주소 쪽을 덮어쓰기 시작.
3. LR 변조: 마침내 침범된 데이터가 **함수가 끝나고 돌아가야 할 주소(LR, 복귀 주소)** 를 덮어씀.

#### 공격 실행: 흐름 빼앗기
- 변조된 LR 값: 해커는 LR이 가리키는 주소를 자신이 **미리 심어둔 악성 코드(쉘코드)** 의 주소로 바꿈.
- 함수 종료: 취약점이 있는 함수가 `return` 명령을 실행함. CPU는 변조된 LR에 저장된 주소(악성 코드 주소)로 점프.
- 결과: 해커가 심어둔 코드가 **프로그램의 권한으로** 실행됨. (예: 터미널 쉘 띄우기, 시스템 파일 삭제 등)

# OS의 방어 매커니즘
현대 OS는 이러한 스택 기반 공격을 막기 위해 하드웨어(MMU)와 스프트웨어를 활용한 방어막을 침.

#### ASLR (Address Space Layout Randomization)
- 원리: 프로그램이 실행될 때마다 코드(`.text`), 힙, 스택의 **시작 주소를 무작위로 변경** 함.
- 방어 효과: 해커가 악성 코드를 심어놓고 **"몇 번지(LR 값)로 점프해라** 라고 지정할 수 없게 만듦. (주소가 매번 바뀌므로)

#### DEP (Data Execution Prevention) 또는 NX Bit (No-eXecute)
- 원리: MMU의 페이지 테이블 접근 권한을 이용함. 스택과 데이터 영역에 E(Execute) 권한을 강제로 제거함.
- 방어 효과: 해커가 스택에 악성 코드(쉘코드)를 심더라도, CPU가 그 코드를 실행하려 하면 MMU가 즉시 페이지 폴트를 발생시켜 프로세스를 종료시킴.

