고정된 주소(Flash: `0x08...`, RAM: `0x20...`) 개념과는 달리, 일반 OS에서는 프로그램이 실행될 때마다 주소가 완전히 바뀜. 왜?

# 가상 메모리의 필요성: 분리와 보호
임베디드(RTOS)에서는 모든 Task가 하나의 물리적 RAM 주소를 공유했음. 이는 빠르지만, 하나의 Task가 오류를 일으키면 시스템 전체가 멈춤.

가상 메모리는 이 문제를 해결함.
1. 독립성: 모든 프로세스는 자신이 메모리를 혼자 쓰고 있다고 착각하게 만듦. (예: Word, Chrome, 게임 모두 0번지부터 시작한다고 생각함)
2. 보호 (Protection): A 프로세스가 B 프로세스의 메모리 영역을 절대로 침범하거나 덮어쓰지 못하도록 막음.

# 핵심 하드웨어: MMU (Memory Management Unit)
가상 메모리 시스템의 모든 마법은 CPU 내부에 있는 **MMU(메모리 관리 장치)** 가 담당.
- 역할: CPU가 요청한 **가상 주소(Virtual Address)** 를 **물리 주소(Physical Address)** 로 실시간 변환해 주는 주소 변환기.

#### 주소 변환 과정 (The Translation)
1. CPU 실행: CPU는 코드에서 `0x1000`번지의 변수 `data`를 읽으라고 명령함. (이 주소는 가상 주소)
2. MMU 요청: MMU가 이 `0x1000` 가상 주소를 받음.
3. 페이지 테이블 조회: MMU는 **페이지 테이블(Page Table)** 이라는 지도책을 봄.
4. 물리 주소 획득: 페이지 테이블에 "가상 주소 `0x1000`은 물리 주소 `0xA0010000`에 매핑되어 있음"이라고 적혀 있음.
5. 메모리 접근: MMU가 `0xA0010000`번지에 접근하여 데이터를 가져옴.

	결론: 프로그램은 가상 주소를 사용하고, MMU만이 실제 RAM의 어디에 저장되었는지 알고 있음.

# 페이지와 페이지 테이블의 원리
주소 변환은 바이트 단위가 아니라 **페이지(Page)** 라는 고정된 크기 단위(버텅 4KB)로 이루어짐.

#### 페이지 테이블 (Page Table)
- 페이지 테이블은 **운영체제(OS)** 가 관리하는 거대한 배열(자료 구조)임.
- 각 프로세스마다 고유한 페이지 테이블을 가지고 있음. (프로세스 스위칭 시 이 테이블의 주소를 MMU에 로드함)

#### 메모리 단편화 문제 해결 (Fragmentation)
임베디드에서 배웠던 힙 조각화가 물리 메모리에서도 발생하면 안 됨.
- 가상 메모리 시스템은 프로세스의 메모리를 연속된 물리적 공간에 놓을 필요가 없음.
- 프로세스는 10MB의 메모리가 필요할 때, 연속된 10MB가 아니라, 따로 떨어진 4KB의 페이지 2500개만 있으면 됨. (페이지 테이블이 이 조각들을 엮어줌)
- 효과: 힙 조각화가 물리 메모리 영역에서 발생하는 것을 완벽하게 방지할 수 있음.

#### 가상 메모리와 보안 (MMU의 방패)
MMU는 주소 변환 외에, 메모리 보호라는 가장 중요한 보안 기능을 수행함.

페이지 테이블에는 각 페이지에 대한 **접근 권한 비트** 가 있음.

| 권한 비트       | 설명     | 예시                      |
| ----------- | ------ | ----------------------- |
| R (Read)    | 읽기만 허용 | 코드 영역(`.text`)          |
| W (Write)   | 쓰기 허용  | 데이터 영역(`.data`, `.bss`) |
| E (Execute) | 실행 허용  | 코드 영역(`.text`)          |

#### 보안 작동 원리
1. 공격 시나리오: 해커가 데이터 영역(`.data`나 스택)에 악성 코드를 삽입한 후, 실행을 시도(`jmp`)함.
2. MMU 방어: MMU는 페이지 테이블을 확인하여 데이터 영역에는 E(Execute) 권한이 없음을 확인함.
3. 결과: CPU에게 **페이지 폴트(Page Fault)** 인터럽트를 발생시키고, OS가 해당 프로세스를 강제 종료시킴. (흔히 보는 '프로그램 작동 중지' 오류)

	임베디드 연결: `const` 변수는 읽기 전용(`.rodata`) 영역에 배치되는데, MMU는 이 영역에 W(Write) 권한을 아예 제거하여 하드웨어적으로 보호함.

# OS 심화와 해킹
시스템 해킹의 기본 개념과 OS의 나머지 영역을 연결.
1. 해킹 연결: 스택 오버플로우가 가상 메모리 환경에서는 **메모리 보호(ASLR, DEP)** 를 어떻게 우회하려 시도하는지 이해할 수 있음.
2. OS 연결: 프로세스 스케줄링, 파일 시스템 등 OS의 다른 핵심 기능들이 이 가상 메모리 구조 위에서 어떻게 동작하는지 배우면 됨.

