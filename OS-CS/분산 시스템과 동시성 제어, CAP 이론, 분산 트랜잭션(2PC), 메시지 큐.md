**분산 시스템(Distributed Systems)** 과 **동시성 제어**.

# 분산 시스템의 딜레마: CAP 이론
분산 시스템을 설계할 때, 우리는 완벽함을 추구하지만, 근본적으로 **세 가지 속성 중에 두 가지만 선택** 할 수밖에 없는 딜레마에 봉착함.

| 속성    | 영어 명칭               | 설명                                             |
| ----- | ------------------- | ---------------------------------------------- |
| 일관성   | Consistency         | 모든 사용자에게 동일한 최신 데이터가 보여야 함. (데이터 무결성)          |
| 가용성   | Availability        | 요청이 들어오면 반드시 응답해야 함. (일부 노드가 죽어도 서비스가 계속되어야 함) |
| 분할 내성 | Partition Tolerance | 네트워크 분할(일부 노드 간 통신 단절)이 일어나도 시스템이 동작해야 함.      |

#### 선택의 법칙 (CAP Theorem):
- **P(분할 내성)** 는 인터넷 기반 분산 시스템에서는 피할 수 없는 현실이므로, **거의 필수적으로 선택** 함.
- 따라서 우리는 **CA (Consistency  + Availability)** 를 동시에 충족할 수 없으며, **C(일관성)** 를 선택할지 **A(가용성)** 를 선택할지 결정해야 함.
	- CP 선택: 일관성을 위해 노드가 통신 불가능할 때 서비스 중단을 감수함. (은행 시스템, 분산 락)
	- AP 선택: 일관성을 희생하고 노드가 통신 불가능할 때 **오래된 데이터라도 제공** 하여 서비스 지속성을 확보함. (대부분의 웹 서비스, SNS)

# 일관성 확보: 분산 트랜잭션 (2PC)
데이터베이스가 여러 대의 서버에 흩어져 있을 때, 이 모든 서버의 데이터가 동시에 커밋(Commit)되거나 롤백(Rollback)되도록 보장하는 **고전적인 프로토콜**.

#### 2단계 커밋 (Two-Phase Commit, 2PC)
2PC는 **코디네이터(Coordinator)** 와 **참여자(Participants)** 로 구성됨.
1. 1단계: 투표 단계 (Prepare Phase)
	- 코디네이터가 모든 참여자에게 "트랜잭션을 실행할 준비가 되었는가?"라고 물음.
	- 참여자들은 데이터 변경을 메모리 등에 임시 저장하고 "준비 완료(Ready)" 또는 "실패(Abort)"를 회신함.
	- 하나라도 Abort: 코디네이터는 "모두 롤백하라!"는 명령을 내림.
- 단점 (CAP 연결): 2PC는 **강력한 일관성(C)** 을 보장하지만, 코디네이터가 모든 참여자의 응답을 기다리는 동안 **리소스가 잠기는(Blocking)** 문제가 발생하며, 참여자 중 하나라도 응답하지 않으면 전체 시스템이 멈출 수 있어 **가용성(A)이 떨어짐.**

# 비동기 통신: 메시지 큐 (Message Queue)
분산 시스템의 성능 향상과 **느슨한 결합(Decoupling)** 을 위해 **메시지 큐(MQ)** 가 필수적으로 사용됨.

#### 메시지 큐의 역할
- 비동기 처리: 사용자의 요청(메시지)을 즉시 처리하지 않고 큐에 넣어둠. 생산자(Producer)는 큐에 메시지를 넣고 바로 다음 일을 함.
- 부하 분산: 갑자기 요청이 몰려도 큐가 완충제 역할을 하여 서버 과부하를 막고, 처리 가능한 속도로 소비자(Consumer)가 메시지를 가져가게 함.
- 결합도 낮춤: 웹 서버(생산자)는 어떤 서버(소비자)가 메시지를 가져갈지 알 필요가 없음. 시스템간의 의존성이 낮아짐.

#### 임베디드와의 연결
RTOS에서 배운 **메일박스(Mailbox)** 나 **메시지 큐** 는 단일 MCU 내부의 태스크 간 통신 수단이었음. 분산 시스템의 MQ는 이 개념을 **네트워크 서버 간 통신** 으로 확장한 것. (예: Kafka, RabbitMQ)

