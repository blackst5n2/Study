Dynamic BVH는 Quadtree나 Octree와 같은 정적 공간 분할 구조의 한계를 넘어, 끊임없이 움직이는 수백, 수천 개의 물체가 존재하는 게임이나 시뮬레이션 환경에서 충돌 검사 속도를 획기적으로 가속하는 기술임.

# Dynamic BVH (동적 경계 볼륨 계층 구조)
#### BVH의 정의 및 목표
- BVH (Bounding Volume Hierarchy): **경계 볼륨(Bounding Volume, BV)** 을 가진 물체들을 트리 구조로 계층화한 것.
	- 경계 볼륨: 물체를 감싸는 단순한 기하학적 형태 (예: 구(Sphere), 직육면체(AABB)).
	- 목표: 복잡한 물체 간의 충돌 검사를 수행하기 전에, 단순한 경계 볼륨끼리 먼저 충돌하는지 확인하여 불필요한 계산을 **가지치기(Pruning)** 함.
- Dynamic BVH의 목표: 물체가 매 프레임 움직여도 트리의 효율서을 유지하여 충돌 검사 시간을 $O(\log n)$ 수준으로 보장하는 것.

#### 정적 BVH와 동적 BVH의 차이
| 특징      | 정적 BVH (Static)      | 동적 BVH             |
| ------- | -------------------- | ------------------ |
| 주 사용처   | 렌더링 (Ray Tracing) 가속 | 물리 엔진, 충돌 감지       |
| 물체의 움직임 | 고정 또는 매우 느림          | 매 프레임 빠르게 움직임      |
| 트리 관리   | 한 번 생성 후 거의 변경 없음    | 물체 이동 시 트리를 갱신/재배치 |

#### Dynamic BVH의 핵심 로직: 재구축 (Rebalancing)
일반적인 BVH는 물체가 움직여 경계 볼륨이 커지거나 위치가 바뀌면 트리의 효율(높이)이 깨짐.
Dynamic BVH는 이 문제를 해결하기 위해 노드를 삭제/삽입하는 연산을 통해 트리의 균형을 유지함.

##### 핵심 원리:
1. 경계 확장 (Fat BV): Dynamic BVH의 노드는 물체의 현재 위치뿐만 아니라, 다음 프레임에 물체가 이동할 예상 영역까지 포함하는 약간 더 큰 경계 볼륨을 가짐. 이를 통해 빈번한 노드 갱신을 줄임.
2. 삭제 및 삽입: 물체가 크게 움직여 경계 볼륨을 벗어나거나, 트리의 효율이 일정 수준 이하로 떨어지면, 해당 물체가 속한 리프 노드를 삭제한 후, 새로운 위치에서 다시 삽입함.
3. 최적의 삽입 위치: 새 노드를 삽입할 때, 트리의 높이가 가장 낮아지고 노드의 **총 비용(Cost, 경계 (볼륨의 넓이)** 이 가장 적게 증가하는 위치를 찾는 삽입함. 이 과정에서 **트리 회전 (Rotation)** 이 발생하여 균형을 잡음.

#### 충돌 검사 로직 (Query)
Dynamic BVH를 사용한 충돌 검사는 쿼드 트리 검색과 유사하지만, 3차원에서 이루어짐.
1. 쿼리: 충돌 검사를 원하는 두 물체(A와 B)의 경계 볼륨을 루트부터 비교함.
2. 가지치기: A의 경계 볼륨과 B의 자식 노드 경계를 볼륨이 겹치지 않으면(No Intersection), 해당 자식 노드가 포함하는 수많은 물체와의 검사를 **즉시 생략(Pruning)** 함.
3. 재귀: 겹치는 경우에만 자식 노드로 재귀적으로 내려가 리프 노드에 도달할 때까지 반복함.

#### 응용 분야
- 물리 엔진: Box2D, Bullet Physics 등에서 수백 개의 관절과 물체 간의 충돌 쌍을 효율적으로 찾는 데 사용됨.
- 레이 트레이싱: 렌더링 파이프라인에서 광선(Ray)이 수백만 개의 삼각형 중 어떤 것과 교차하는지 빠르게 찾는 데 정적 BVH가 사용됨.
