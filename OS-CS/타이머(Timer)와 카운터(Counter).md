임베디드 시스템에서 **"시간"** 을 지배하는 핵심 하드웨어.

타이머는 **"내가 정한 시간에 정확하게 사건을 발생시키는 것**. CPU가 시계를 보며 숫자를 세는 것이 아니라, **별도의 기계식 초시계 하드웨어** 가 알아서 돌아가는 원리.

# 타이머의 원리: "심장 박동 세기"
타이머는 복잡한 시계가 아니라, 단순히 **입력되는 클럭(펄스)의 개수를 세는 기계**.
1. System Clock (심장 박동): MCU의 메인 클럭(예: 100Mhz)이 타이머로 들어옴.
2. Prescaler (기어 박스): 클럭이 너무 빠르면 세기 힘듦. 그래서  **속도를 늦춤**
	- 100MHz 클럭을 1000분주(Prescaler - 1000)하면, 100kHz(1초에 10만 번)로 느려짐.
3. Counter Register (CNT): 실제 숫자가 올라가는 변수임. 클럭이 한 번 칠 때마다 `0` -> `1` -> `2`... 하고 증가함.
4. Auto-Reload Register (ARR): **"목표값"**. 카운터(CNT)가 이 값에 도달하면 다시 0으로 돌아감.

# 핵심 기능 1: 정확한 시간 재기 (Time Base)
초보자는 `delay(1000);` 함수를 써서 1초를 쉼. 하지만 이는 **"1초 동안 CPU야, 아무것도 하지말고 멈춰 있어라"** 라는 뜻. (Busy Waiting).

#### 타이머를 사용하면?
1. 설정: 타이머에게 "1초가 되면 나한테 알려줘(인터럽트)"라고 설정하고 CPU는 다른 일을 함.
2. 동작:
	- 타이머 하드웨어가 백그라운드에서 숫자를 셈.
	- 목표값(ARR)에 도달하면 **"Update Interrupt"** 를 발생시킴.
3. ISR 실행: CPU가 하던 일을 멈추고 `Timer_IRQHandler`로 가서 LED를 토글함.

	결론: CPU 점유율 **0%** 로 정확한 1초를 잴 수 있음. 이것이 멀티태스킹의 기초.

# 핵심 기능 2: PWM (Pulse Width Modulation)
타이머의 꽃. 다지털(0과 1)밖에 없는 MCU가 **아날로그(0V ~ 3.3V 사이의 전압)** 를 흉내 내는 기술
- 원리: LED를 1초에 1,000번 껐다 켰다 함.
	- 50% 켜짐 / 50% 꺼짐: 우리 눈에는 중간 밝기로 보임. (평균 전압 1.65V 효과)
	- 90% 켜짐 / 10% 꺼짐: 우리 눈에는 아주 밝게 보임. (평균 전압 3.0V 효과)

#### 하드웨어 동작 (Output Compare)
타이머 안에는 **CCR (Capture/Compare Register)** 이라는 기준값이 하나 더 있음.
1. CNT(혐재 카운타)가 올라가기 시작.
2. CNT < CCR: 핀 출력을 **High(1)** 로 유지.
3. CNT > CCR: 핀 출력을 **Low(0)** 로 떨어뜨림.
4. CNT == ARR: 0으로 초기화되고 다시 High가 됨.

코드에서 **CCR 레지스터 값만 슥 바꾸면**, LED 밝기나 모터의 속도가 즉시 변함. CPU가 핀을 껏다 켰다 할 필요가 전혀 없음.

# 실전 계산: "1초를 만들려면?"
이 부분이 엔지니어의 계산 영역. (예: 시스템 클럭 100MHz)

#### 목표: 1초(1Hz) 마다 인터럽트 발생시키기
1. Prescaler (PSC) 설정: 클럭을 10kHz(초당 1만 번)로 낮추고 싶다.
	- $100,000,000/10,000 = 10,000$ 분주
	- `PSC 레지스터 = 9999` (0부터 세니까 1을 뺌)
2. Auto-Reload (ARR) 설정: 10kHz 속도로 몇 번 세야 1초가 될까?
	- 10,000번 세면 됨.
	- `ARR 레지스터 = 9999`

C 코드 (개념):
```c
TIM2->PSC = 9999; // 100MHz -> 10kHz로 감속
TIM2->ARR = 9999; // 10,000번 세면 1초 (Overflow)
TIM2->DIER |= 1; // 인터럽트 켜기 (Update Interrupt Enable)
TIM2->CR1 |= 1; // 타이머 시작! (Counter Enable)
```
이제 이 코드가 실행되면, 정확히 1초마다 NVIC를 통해 인터럽트 함수가 호출.

# 요약
타이머/카운터는 **"하드웨어적으로 숫자를 세는 기계"**
- Time Base: 정확한 주기(1ms, 1초)를 만들어 스케줄링에 사용.
- PWM: 출력 파형의 비율(Duty Cycle)을 조절해 LED 밝기나 모터 속도를 제어.
- Input Capture (심화): 반대로 외부에서 들어오는 신호의 시간 간격을 잴 수도 있음. (초음파 센서 거리 측정 등)
