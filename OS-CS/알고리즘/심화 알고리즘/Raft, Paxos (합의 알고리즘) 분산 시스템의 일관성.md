#### 목표: 분산 시스템에서 장애가 발생하거나 통신이 불안정해도 **모든 노두가 하나의 값(진실)** 에 동의하도록 보장
Raft와 Paxos는 복잡하고 현실적인 엔진니어링 문제를 해결하는 분산 시스템의 심장임. 특히 Raft는 Paxos보다 이해하기 쉽게 설계되었지만, 목표는 같음: 복제된 상태 기계(Replicated State Machine)의 일관성 보장.

#### 핵심 원리: 리더 기반 복제와 쿼럼(Quorum) 투표
Raft를 중심으로 원리를 설명
1. 노드의 역할: 모든 노드는 다음 세 가지 역할 중 하나를 가짐.
	- Leader (리더): 모든 클라이언트 요청을 처리하고, 로그 복제(Replication)를 담당하는 유일한 노드.
	- Follower (팔로워): 리더로부터 요청을 받고 수동적으로 복제하는 노드.
	- Candidate (후보): 리더가 죽거나 선출 기간이 끝나면 리더가 되기 위해 투표를 요청하는 노드.
2. 리더 선출 (Leader Election):
	- Follower가 정해진 시간(Timeout) 동안 리더의 메시지를 받지 못하면 Candidate가 됨.
	- Candidate는 다른 노드들에게 **"나에게 투표해 달라"** 고 요청함.
	- 쿼럼(Quorum, 과반수) 이상의 노드로부터 투표를 받으면 리더가 됨. (예: 노드 5개 중 3개)
3. 로그 복제 (Log Replication):
	- 클라이언트의 모든 쓰기 요청은 반드시 리더를 거쳐야 함.
	- 리더는 명령(로그)을 Follower들에게 보냄.
	- 로그가 과반수의 Follower 노드에 복제되었음이 확인되면, 리더는 해당 로그를 **커밋(Commit)** 하고 클라이언트에게 성공을 응답함.
	- 핵심: 과반수가 동의하면, 소수 노드에 장애가 발생하거나 통신 오류가 있어도 시스템은 계속 일관된 상태를 유지함.
- 응용: Etcd, Consul, ZooKeeper와 같은 분산 환경의 **상태 저장소(State Store)** 나, 분산 데이터베이스의 트랜잭션 관리, 블록체인의 합의 방식 등에 영향을 주었음.

# 구현 전략
#### 목표: Fault Tolerance (내결합성)을 갖춘 일관성(Consistency) 확보
분산 시스템에서 여러 노드(서버)기 동시에 작업할 때, 일부 노드에 장애가 발생하거나 네트워크가 끊겨도 모든 노드가 하나의 최종 값(로그, 상태)에 동의하도록 보장하는 것이 목표임.
- Paxos (파소스): 분산 합의 이론이 골드 스탠다드이나, 복잡하고 이해하기 어려워 구현 난이도가 매우 높음.
- Raft (뗏목): Paxos의 단점을 개선하여 **'이해하기 쉬운 합의 알고리즘'** 을 목표로 설계되었으며, 현대 분산 시스템에서 널리 사용됨. Raft를 중심으로 핵심 논리를 탐구.

#### 1. Raft의 핵심 개념: 리더 기반 복제와 임기(Term)

##### 노드의 역할 (State)
Raft는 시스템의 상태를 명확히 세 가지로 나눔.
1. Follower (추종자): 수동적이며, 리더나 후보자로부터 메시지를 기다림.
2. Candidate (후보자): 리더 선출을 위해 투표를 요청하고 기다리는 상태.
3. Leader (리더): 모든 클라이언트 요청을 처리하고,로그 복제(Replication)를 담당하는 유일한 노드.

##### 임기 (Term)
- 논리: 시간은 '임기(Term, 정수)'라는 단위로 나뉨. 각 임기마다 최대 한 명의 리더가 선출될 수 있음.
- 용도: 임기는 노드 간의 충돌(Stale Information)을 방지하는 논리적 시계 역할을 함. 노드는 항상 더 높은 임기를 따름.

#### 2. 합의의 두 가지 핵심 단계
##### 리더 선출 (Leader Election)
- 트리거: Follower가 임의의 시간(Randomized Election Timeout) 동안 리더로부터 **Heartbeat (활동 신호)** 를 받지 못하면, 리더가 죽었다고 판단하고 Candidate로 전환함.
- 투표 요청: Candidate는 자신의 임기 번호를 증가시키고, 다른 모든 노드에게 "투표 요청(RequestVote)" 메시지를 보냄.
- 쿼럼(Quorum)의 중요성: 후보자는 전체 노드 중 **과반수(Majority)** 의 투표를 받아야 리더가 될 수 있음. (예: 노드 5개 중 3개). 과반수 합의는 스플릿 브레인(Split-Brain) 시나리오(동시에 두 리더가 존재)를 방지하는 핵심.

##### 로그 복제 (Log Replication)
- 클라이언트 요청: 모든 쓰기 요청(데이터 변경)은 반드시 리더를 거침.
- AppendEntries: 리더는 클라이언트의 요청(Log Entry)을 Follower들에게 AppendEntries (로그 추가) 메시지를 통해 복제함. 이 메시지는 Heartbeat의 역할도 겸함.
- 커밋 (Commit): 로그 엔트리가 과반수 이상의 노드에 안전하게 저장되었음이 리더에게 확인되면, 리더는 해당 로그를 **커밋(Commit)** 하여 시스템의 영구적인 상태로 만듦. 이후 커밋된 값만 클라이언트에게 응답됨.
- 로그 일관성: Raft는 리더가 된 노드가 자신의 로그를 강제로 Follower들의 로그와 일치시키는 가력한 메커니즘을 사용함. 이를 통해 Log Matching Property를 보장함.

#### 3. Raft의 장점 (Paxos 대비)
- 모듈화: 리더 선출, 로그 복제, 안전성 등 논리가 명확하게 분리되어 이해하기 쉬움.
- 강력한 리더: 리더가 일단 선출되면 모든 데이터 흐름과 결정을 릳거ㅏ 주도하여 논리가 단순해짐.
- 직관적인 안전성: 과반수 합의를 통해 항상 최신 데이터를 가진 노드가 리더가 되도록 보장하여 데이터 손실 위험을 최소화함.
